<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Optimizing your Nikola blog for Jupyter notebooks | Mike Jarrett</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://notes.mikejarrett.ca/optimizing-your-nikola-blog-for-jupyter-notebooks/">
<link rel="icon" href="../images/favicon.ico" sizes="16x16">
<link rel="apple-touch-icon" href="../images/apple-icon-57x57.png" sizes="57x57">
<link rel="apple-touch-icon" href="../images/apple-icon-60x60.png" sizes="60x60">
<link rel="apple-touch-icon" href="../images/apple-icon-72x72.png" sizes="72x72">
<link rel="apple-touch-icon" href="../images/apple-icon-76x76.png" sizes="76x76">
<link rel="apple-touch-icon" href="../images/apple-icon-114x114.png" sizes="114x114">
<link rel="apple-touch-icon" href="../images/apple-icon-120x120.png" sizes="120x120">
<link rel="apple-touch-icon" href="../images/apple-icon-144x144.png" sizes="144x144">
<link rel="apple-touch-icon" href="../images/apple-icon-152x152.png" sizes="152x152">
<link rel="apple-touch-icon" href="../images/apple-icon-180x180.png" sizes="180x180">
<link rel="icon" href="../images/android-icon-192x192.png" sizes="192x192">
<link rel="icon" href="../images/favicon-32x32.png" sizes="32x32">
<link rel="icon" href="../images/favicon-96x96.png" sizes="96x96">
<link rel="icon" href="../images/favicon-16x16.png" sizes="16x16">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><meta property="og:image" content="https://data.mikejarrett.ca/images/logo.png">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-132843241-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132843241-1');
</script><meta name="author" content="Mike Jarrett">
<link rel="prev" href="../connecting-neighbourhoods/" title="Connecting neighbourhoods" type="text/html">
<link rel="next" href="../mynotebook/" title="mynotebook" type="text/html">
<meta property="og:site_name" content="Mike Jarrett">
<meta property="og:title" content="Optimizing your Nikola blog for Jupyter notebooks">
<meta property="og:url" content="https://notes.mikejarrett.ca/optimizing-your-nikola-blog-for-jupyter-notebooks/">
<meta property="og:description" content="You've installed Nikola. You've also followed some instructions on how to use Jupyter notebooks as posts. Everything works! But after you make your first Jupyter post, the results are... uninspiring. ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-01-14T16:27:18-08:00">
<meta property="article:tag" content="jupyter">
<meta property="article:tag" content="nikola">
<meta property="article:tag" content="theme">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@mikejarrett_">
<link rel="stylesheet" href="../assets/css/bootyper.css">
<script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script><script type="text/javascript" src="../assets/js/bootyper.js"></script><script type="text/javascript">
    
        code_show = false;
    console.log("head test");
    console.log(code_show);
    $( document ).ready(code_toggle);
    
    
    
    // if the image in the window of browser when the page is loaded, show that image (fade in)
    $(document).ready(function(){
        showImages('article img');
    });

    // if the image in the window of browser when scrolling the page, show that image
    $(window).scroll(function() {
        showImages('article img');
    });
    </script>
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://notes.mikejarrett.ca/">
                <img src="../images/logo-rect.png" alt="Mike Jarrett" id="logo"><span id="blog-title">Mike Jarrett</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../archive.html">Archive</a>
                </li>
<li>
<a href="../categories/">Tags</a>
                </li>
<li>
<a href="../rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
    <a href="index.ipynb" id="sourcelink">Source</a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Optimizing your Nikola blog for Jupyter notebooks</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Mike Jarrett
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-01-14T16:27:18-08:00" itemprop="datePublished" title="2019-01-14 16:27">2019-01-14 16:27</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/optimizing-your-nikola-blog-for-jupyter-notebooks.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div>






<form id="toggle-button" action="javascript:code_toggle()"><input type="submit" class="btn btn-primary" value="Click here to toggle on/off the raw code."></form>
    </div>
    

    <div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You've installed <a href="https://getnikola.com">Nikola</a>. You've also followed <a href="https://mglerner.github.io/posts/switching-to-nikloa-for-jupyter-notebooks-and-a-static-site.html">some instructions on how to use Jupyter notebooks as posts</a>. Everything works! But after you make your first Jupyter post, the results are... uninspiring. The input prompts are ugly. If you've written a post designed primarily for the content, not the code, there's no was to turn off showing the code cells. This post will describe how I -- someone with almost no experience with javascript, CSS, etc -- made my blog more functional to work with Jupyter notebooks.</p>
<!-- TEASER_END -->

<h2 id="Install-Nikola">Install Nikola<a class="anchor-link" href="#Install-Nikola">¶</a>
</h2>
<p>Follow the instructions on the Nikola website, or a million blog posts from other users.</p>
<h2 id="Pick-a-theme">Pick a theme<a class="anchor-link" href="#Pick-a-theme">¶</a>
</h2>
<p>Pick the theme you like best and install with <code>nikola theme -i theme_name</code>. I used the bootstrap3 theme. These instructions should work for any Bootstrap-based theme, and possible others though I haven't tested them.</p>
<h2 id="Create-a-new-theme">Create a new theme<a class="anchor-link" href="#Create-a-new-theme">¶</a>
</h2>
<p>Nikola allows for theme inheritance, so we'll create a new theme that inherits from bootstrap3. This means in our new theme we only have to create the files we want to change, otherwise Nikola will fall back to the parent theme. Following the <a href="https://getnikola.com/creating-a-theme.html">official instructions</a>:</p>
<p><code>nikola theme -n bootyper --parent bootstrap4 --engine mako</code></p>
<p>This will create a new directory <code>/themes/bootyper</code> which is empty except for a file called bootyper.theme. You'll also be prompted to update your current theme in your conf.py file. Might as well do that now. While you're in conf.py, update the following sections.</p>

<pre><code>POSTS = (
    ("posts/*.rst", "posts", "post.tmpl"),
    ("posts/*.md", "posts", "post.tmpl"),
    ("posts/*.txt", "posts", "post.tmpl"),
    ("posts/*.html", "posts", "post.tmpl"),
    ("posts/*.ipynb", "posts", "post_ipynb.tmpl"),
)
PAGES = (
    ("pages/*.rst", "pages", "page.tmpl"),
    ("pages/*.md", "pages", "page.tmpl"),
    ("pages/*.txt", "pages", "page.tmpl"),
    ("pages/*.html", "pages", "page.tmpl"),
    ("pages/*.ipynb", "pages", "post_ipynb.tmpl"),
)</code></pre>
<p>What we're doing here is telling Nikola that when you add a Jupyter notebook as a page or post, that you want to use a different template file called <code>post_ipynb.tmpl</code>.</p>
<h2 id="Make-a-Jupyter-template">Make a Jupyter template<a class="anchor-link" href="#Make-a-Jupyter-template">¶</a>
</h2>
<p>Now let's make that template. Copy the <code>post.tmpl</code> file from your parent theme and rename it as so:</p>
<p><code>cp ./themes/bootstrap4/templates/post.tmpl ./themes/bootyper/templates/post_ipynb.tmpl</code></p>
<p>Now we're free to modify the new template file, and it will only apply to posts that use Jupyter notebooks. First let's add a custom CSS file to the header. The post template we're using provides us with a block of code called "extra_head" which will be inserted into the end of the <code>&lt;head&gt;</code> element when the HTML is rendered. Let's link to our custom CSS file here</p>

<pre><code>&lt;%block name="extra_head"&gt;
[...]
&lt;link rel="stylesheet" href="../assets/css/bootyper.css"&gt;
&lt;/%block&gt;</code></pre>
<h2 id="Clean-up-the-Jupyter-CSS">Clean up the Jupyter CSS<a class="anchor-link" href="#Clean-up-the-Jupyter-CSS">¶</a>
</h2>
<p>We need to create the file we just linked to. Open a new file <code>./themes/bootyper/assets/css/bootyper.css</code>. This is where we'll stick our custom CSS that only applies to posts and pages made with Jupyter notebooks.</p>

<pre><code>div.prompt {
    display: none;
}

div.input  {
    border: none;
    background-color: none;
}

div.input * {
    background-color: none;
}

/* set a max-width for horizontal fluid layout and make it centered */
.body-content {
  margin-right: auto;
  margin-left: auto;
  max-width: 750px; /* or 950px */
}

div.output_subarea {
    /* Widens image-containing divs so that image is full body width */
    max-width: 100%;
}</code></pre>
<p>It's totally up to you how to style your notebook. I totally ditch the input prompts, but instead you could just make them prettier than the default. I also change the styling of the input code blocks, and make the content div a little narrower so it's easier to read on wider screens. Finally I make embedded images the full width of the content div. I'm not much of a designer so I stop here, but the possibilities are of course endless.</p>
<h2 id="Going-further-with-Javascript">Going further with Javascript<a class="anchor-link" href="#Going-further-with-Javascript">¶</a>
</h2>
<p>The one thing I really wanted for my blog was to make it optional for the reader to see the raw code. Some posts would be designed as code-throughs, but others would be read mainly for the text and images and the code would be an extra for those interested. I've added two features to make this possible: 1) A button that toggles the visibility of the input code blocks, and 2) a metadata setting to set the default visibility of the code blocks on page load. Let's create a javascript library for these features in <code>./themes/bootyper/assets/js/bootyper.js</code>.</p>

<pre><code>function code_toggle() {
    if (!code_show){
    $('div.input').hide();
    //$('div.prompt.output_prompt').hide();  //unnecessary since I'm hiding all prompts anyways in css
    } else {
    $('div.input').show();
    }
 code_show = !code_show
}</code></pre>
<p>This function checks the value of the javascript variable <code>code_show</code> and either shows or hides the div with the input code, then switches the value of code_show. We'll run this function on page load, and then when the reader clicks on a button to show/hids the code.</p>
<p>Now we need to make another update to our template file <code>post_ipynb.tmpl</code>:</p>

<pre><code>&lt;%block name="extra_head"&gt;
[...]
&lt;link rel="stylesheet" href="../assets/css/bootyper.css"&gt;
&lt;script type="text/javascript" src="https://code.jquery.com/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="../assets/js/bootyper.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;
code_show = false;
$( document ).ready(code_toggle);
&lt;/%block&gt;</code></pre>
<p>Here we've added a jquery library and our custom bootyper.js file. I've hard-coded in the default value of <code>code_show</code> as false, then I call the <code>code_toggle</code> function so that when the page loads the code cells aren't shown. Further down in the template file we can add a button to run this script:</p>

<pre><code>&lt;%block name="content"&gt;
&lt;article class="post-${post.meta('type')} h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"&gt;
    ${pheader.html_post_header()}


    &lt;form id="toggle-button" action="javascript:code_toggle()"&gt;&lt;input type="submit" class="btn btn-primary" value="Click here to toggle on/off the raw code."&gt;&lt;/form&gt;
    [...]
&lt;/%block&gt;</code></pre>
<p>We're only adding the <code>&lt;form&gt;</code> element. I place the button immediately at the top of the content of the article, below the title and data/author. You can place it wherever you'd prefer, and give it any style you'd like. Again I just keep it simple and use a default bootstrap button style. And that's all it takes to have a button to optionally show or hide the input code in your Jupyter notebook!</p>
<h2 id="One-more-step:-Nikola-metadata">One more step: Nikola metadata<a class="anchor-link" href="#One-more-step:-Nikola-metadata">¶</a>
</h2>
<p>Finally, I want to be able to set the default <code>code_show</code> value on a post by post basis. I do this using the notebook metadata. In Jupyter, go to Edit-&gt;Edit Notebook Metadata and you'll see see some JSON elements. By running <code>nikola add_post -i notebook.ipynb</code> to add your notebook as a Nikola post, Nikola will insert some custom fields into the JSON. We just need to add one field, <code>code = "false"</code>, to the metadata so it looks something like:</p>

<pre><code>{
  "kernelspec": {
    "name": "python3",
    "display_name": "Python 3",
    "language": "python"
  },
  "language_info": {
    "name": "python",
    "version": "3.6.6",
    "mimetype": "text/x-python",
    "codemirror_mode": {
      "name": "ipython",
      "version": 3
    },
    "pygments_lexer": "ipython3",
    "nbconvert_exporter": "python",
    "file_extension": ".py"
  },
  "nikola": {
    "category": "",
    "code": "false",
    "date": "2019-01-14 16:27:18 UTC-08:00",
    "description": "",
    "link": "",
    "slug": "optimizing-your-nikola-blog-for-jupyter-notebooks",
    "status": "draft",
    "tags": "",
    "title": "Optimizing your Nikola blog for Jupyter notebooks",
    "type": "text"
  }
}</code></pre>
<p>These metadata fields will automoatically get passed to the Nikola template engine so they're available to use in your template file. Let's add an if/else statement in the template to set the <code>code_show</code> variable based on our <code>code</code> metadata field.</p>

<pre><code>&lt;%block name="extra_head"&gt;
[...]
&lt;link rel="stylesheet" href="../assets/css/bootyper.css"&gt;
&lt;script type="text/javascript" src="https://code.jquery.com/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript" src="../assets/js/bootyper.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;
% if post.meta('code') in ["false","False"]:
    code_show = false;
% else:
    code_show = true;
% endif
$( document ).ready(code_toggle);
&lt;/%block&gt;</code></pre>
<p>Now if I set the <code>code</code> metadata to "false" or "False" then the code cells will be hidden on page load. Otherwise they'll be shown!</p>
<p>That's it! Hopefully this is a good rundown of the basics of optimizing a Nikola theme for Jupyter notebooks and you'll be able to further customize from here. I keep my version of the bootyper theme on <a href="https://github.com/mjarrett/bootyper">github</a>. It contains the features show here plus a few extra features that aren't in the default theme. Some things I'd like to add in the future is having the code cells show some marker when they're hidden so the reader know's they're there, and also to have the toggle button float as the reader scrolls down the page.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="s2">"Here's the output of a code cell. Use the toggle button to see the code!"</span>
<span class="n">a</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

<div class="prompt output_prompt">Out[2]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>"Here's the output of a code cell. Use the toggle button to see the code!"</pre>
</div>

</div>

</div>
</div>

</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../categories/jupyter/" rel="tag">jupyter</a></li>
            <li><a class="tag p-category" href="../categories/nikola/" rel="tag">nikola</a></li>
            <li><a class="tag p-category" href="../categories/theme/" rel="tag">theme</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../connecting-neighbourhoods/" rel="prev" title="Connecting neighbourhoods">Previous post</a>
            </li>
            <li class="next">
                <a href="../mynotebook/" rel="next" title="mynotebook">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="mikejarrett",
            disqus_url="https://notes.mikejarrett.ca/optimizing-your-nikola-blog-for-jupyter-notebooks/",
        disqus_title="Optimizing your Nikola blog for Jupyter notebooks",
        disqus_identifier="cache/posts/optimizing-your-nikola-blog-for-jupyter-notebooks.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha256-SDRP1VVYu+tgAGKhddBSl5+ezofHKZeI+OzxakbIe/Y=" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
        MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
        </script></article><script>var disqus_shortname="mikejarrett";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2019         <a href="mailto:mike@mikejarrett.ca">Mike Jarrett</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
